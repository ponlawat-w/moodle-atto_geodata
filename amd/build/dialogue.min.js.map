{"version":3,"sources":["../src/dialogue.js"],"names":["define","$","ModalFactory","ModalEvents","GeoTypePointFromMap","GeoTypeGeoJSON","TEMPLATE","M","str","atto_geodata","geotype_pointfrommap","geotype_geojson","typeMappings","point","geojson","currentType","updateType","type","defaultValue","dispose","html","$geotypeTabs","find","removeClass","addClass","init","modalShown","defaultType","click","e","target","attr","value","Promise","resolve","reject","create","types","SAVE_CANCEL","title","body","large","then","modal","getRoot","on","shown","hidden","destroy","save","saveData","preventDefault","hide","show"],"mappings":"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","sourcesContent":["define([\n  'jquery',\n  'core/modal_factory',\n  'core/modal_events',\n  'atto_geodata/geotype_pointfrommap',\n  'atto_geodata/geotype_geojson'\n], (\n  $,\n  ModalFactory,\n  ModalEvents,\n  GeoTypePointFromMap,\n  GeoTypeGeoJSON\n) => {\n\n  const TEMPLATE = '<ul class=\"nav nav-tabs atto_geodata-geotypes\">' +\n    '<li class=\"nav-item\"><a href=\"javascript:void(0);\" data-geotype=\"point\" class=\"nav-link\">'\n    + M.str.atto_geodata.geotype_pointfrommap + '</a></li>' +\n    '<li class=\"nav-item\"><a href=\"javascript:void(0);\" data-geotype=\"geojson\" class=\"nav-link\">'\n    + M.str.atto_geodata.geotype_geojson + '</a></li>' +\n    '</ul>' +\n    '<div id=\"atto_geodata-body\"></div>';\n\n  const typeMappings = {\n    point: GeoTypePointFromMap,\n    geojson: GeoTypeGeoJSON\n  };\n\n  let currentType = null;\n\n  const updateType = (type, defaultValue = undefined) => {\n    if (currentType) {\n      currentType.dispose();\n    }\n\n    $('#atto_geodata-body').html('');\n\n    const $geotypeTabs = $('.atto_geodata-geotypes');\n    $geotypeTabs.find('a').removeClass('active');\n\n    if (typeMappings[type]) {\n      $geotypeTabs.find(`[data-geotype=${type}]`).addClass('active');\n      currentType = typeMappings[type];\n      currentType.init(defaultValue);\n    }\n  };\n\n  const modalShown = (defaultType, defaultValue = undefined) => {\n    updateType(defaultType, defaultValue);\n    const $geotypeTabs = $('.atto_geodata-geotypes');\n    $geotypeTabs.find('a').click(e => {\n      const type = $(e.target).attr('data-geotype');\n      updateType(type);\n    });\n  };\n\n  return (type = 'point', value = undefined) => new Promise((resolve, reject) => {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: 'Test',\n      body: TEMPLATE,\n      large: true\n    }).then(modal => {\n      modal.getRoot().on(ModalEvents.shown, () => { modalShown(type, value); });\n      modal.getRoot().on(ModalEvents.hidden, () => {\n        if (currentType) {\n          currentType.dispose();\n        }\n        modal.destroy();\n        reject();\n      });\n      modal.getRoot().on(ModalEvents.save, e => {\n        if (currentType) {\n          const saveData = currentType.save();\n          if (saveData === false) {\n            e.preventDefault();\n            return;\n          }\n          resolve(saveData);\n        }\n        modal.hide();\n      });\n      modal.show();\n    });\n  });\n\n});\n"],"file":"dialogue.min.js"}
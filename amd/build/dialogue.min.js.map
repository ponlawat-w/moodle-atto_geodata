{"version":3,"sources":["../src/dialogue.js"],"names":["define","$","ModalFactory","ModalEvents","GeoTypePointFromMap","GeoTypeGeoJSON","TEMPLATE","M","str","atto_geodata","geotype_pointfrommap","geotype_geojson","typeMappings","pointfrommap","geojson","currentType","updateType","type","dispose","html","$geotypeTabs","find","removeClass","addClass","init","modalShown","defaultType","click","e","target","attr","Promise","resolve","reject","create","types","SAVE_CANCEL","title","body","large","then","modal","getRoot","on","shown","hidden","destroy","save","saveData","preventDefault","hide","show"],"mappings":"AAAAA,OAAM,yBAAC,CACL,QADK,CAEL,oBAFK,CAGL,mBAHK,CAIL,mCAJK,CAKL,8BALK,CAAD,CAMH,SACDC,CADC,CAEDC,CAFC,CAGDC,CAHC,CAIDC,CAJC,CAKDC,CALC,CAME,IAEGC,CAAAA,CAAQ,CAAG,4JAEbC,CAAC,CAACC,GAAF,CAAMC,YAAN,CAAmBC,oBAFN,gHAIbH,CAAC,CAACC,GAAF,CAAMC,YAAN,CAAmBE,eAJN,qDAFd,CAUGC,CAAY,CAAG,CACnBC,YAAY,CAAET,CADK,CAEnBU,OAAO,CAAET,CAFU,CAVlB,CAeCU,CAAW,CAAG,IAff,CAiBGC,CAAU,CAAG,SAAAC,CAAI,CAAI,CACzB,GAAIF,CAAJ,CAAiB,CACfA,CAAW,CAACG,OAAZ,EACD,CAEDjB,CAAC,CAAC,oBAAD,CAAD,CAAwBkB,IAAxB,CAA6B,EAA7B,EAEA,GAAIP,CAAY,CAACK,CAAD,CAAhB,CAAwB,CACtB,GAAMG,CAAAA,CAAY,CAAGnB,CAAC,CAAC,wBAAD,CAAtB,CACAmB,CAAY,CAACC,IAAb,CAAkB,GAAlB,EAAuBC,WAAvB,CAAmC,QAAnC,EACAF,CAAY,CAACC,IAAb,yBAAmCJ,CAAnC,OAA4CM,QAA5C,CAAqD,QAArD,EACAR,CAAW,CAAGH,CAAY,CAACK,CAAD,CAA1B,CACAF,CAAW,CAACS,IAAZ,EACD,CACF,CA/BE,CAiCGC,CAAU,CAAG,SAAAC,CAAW,CAAI,CAChCV,CAAU,CAACU,CAAD,CAAV,CACA,GAAMN,CAAAA,CAAY,CAAGnB,CAAC,CAAC,wBAAD,CAAtB,CACAmB,CAAY,CAACC,IAAb,CAAkB,GAAlB,EAAuBM,KAAvB,CAA6B,SAAAC,CAAC,CAAI,CAChC,GAAMX,CAAAA,CAAI,CAAGhB,CAAC,CAAC2B,CAAC,CAACC,MAAH,CAAD,CAAYC,IAAZ,CAAiB,cAAjB,CAAb,CACAd,CAAU,CAACC,CAAD,CACX,CAHD,CAID,CAxCE,CA0CH,MAAO,kBAAM,IAAIc,CAAAA,OAAJ,CAAY,SAACC,CAAD,CAAUC,CAAV,CAAqB,CAC5C/B,CAAY,CAACgC,MAAb,CAAoB,CAClBjB,IAAI,CAAEf,CAAY,CAACiC,KAAb,CAAmBC,WADP,CAElBC,KAAK,CAAE,MAFW,CAGlBC,IAAI,CAAEhC,CAHY,CAIlBiC,KAAK,GAJa,CAApB,EAKGC,IALH,CAKQ,SAAAC,CAAK,CAAI,CACfA,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBxC,CAAW,CAACyC,KAA/B,CAAsC,UAAM,CAAEnB,CAAU,CAAC,cAAD,CAAmB,CAA3E,EACAgB,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBxC,CAAW,CAAC0C,MAA/B,CAAuC,UAAM,CAC3C,GAAI9B,CAAJ,CAAiB,CACfA,CAAW,CAACG,OAAZ,EACD,CACDuB,CAAK,CAACK,OAAN,GACAb,CAAM,EACP,CAND,EAOAQ,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBxC,CAAW,CAAC4C,IAA/B,CAAqC,SAAAnB,CAAC,CAAI,CACxC,GAAIb,CAAJ,CAAiB,CACf,GAAMiC,CAAAA,CAAQ,CAAGjC,CAAW,CAACgC,IAAZ,EAAjB,CACA,GAAI,KAAAC,CAAJ,CAAwB,CACtBpB,CAAC,CAACqB,cAAF,GACA,MACD,CACDjB,CAAO,CAACgB,CAAD,CACR,CACDP,CAAK,CAACS,IAAN,EACD,CAVD,EAWAT,CAAK,CAACU,IAAN,EACD,CA1BD,CA2BD,CA5BY,CAAN,CA8BR,CApFK,CAAN","sourcesContent":["define([\n  'jquery',\n  'core/modal_factory',\n  'core/modal_events',\n  'atto_geodata/geotype_pointfrommap',\n  'atto_geodata/geotype_geojson'\n], (\n  $,\n  ModalFactory,\n  ModalEvents,\n  GeoTypePointFromMap,\n  GeoTypeGeoJSON\n) => {\n\n  const TEMPLATE = '<ul class=\"nav nav-tabs atto_geodata-geotypes\">' +\n    '<li class=\"nav-item\"><a href=\"javascript:void(0);\" data-geotype=\"pointfrommap\" class=\"nav-link\">'\n    + M.str.atto_geodata.geotype_pointfrommap + '</a></li>' +\n    '<li class=\"nav-item\"><a href=\"javascript:void(0);\" data-geotype=\"geojson\" class=\"nav-link\">'\n    + M.str.atto_geodata.geotype_geojson + '</a></li>' +\n    '</ul>' +\n    '<div id=\"atto_geodata-body\"></div>';\n\n  const typeMappings = {\n    pointfrommap: GeoTypePointFromMap,\n    geojson: GeoTypeGeoJSON\n  };\n\n  let currentType = null;\n\n  const updateType = type => {\n    if (currentType) {\n      currentType.dispose();\n    }\n\n    $('#atto_geodata-body').html('');\n\n    if (typeMappings[type]) {\n      const $geotypeTabs = $('.atto_geodata-geotypes');\n      $geotypeTabs.find('a').removeClass('active');\n      $geotypeTabs.find(`[data-geotype=${type}]`).addClass('active');\n      currentType = typeMappings[type];\n      currentType.init();\n    }\n  };\n\n  const modalShown = defaultType => {\n    updateType(defaultType);\n    const $geotypeTabs = $('.atto_geodata-geotypes');\n    $geotypeTabs.find('a').click(e => {\n      const type = $(e.target).attr('data-geotype');\n      updateType(type);\n    });\n  };\n\n  return () => new Promise((resolve, reject) => {\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: 'Test',\n      body: TEMPLATE,\n      large: true\n    }).then(modal => {\n      modal.getRoot().on(ModalEvents.shown, () => { modalShown('pointfrommap'); });\n      modal.getRoot().on(ModalEvents.hidden, () => {\n        if (currentType) {\n          currentType.dispose();\n        }\n        modal.destroy();\n        reject();\n      });\n      modal.getRoot().on(ModalEvents.save, e => {\n        if (currentType) {\n          const saveData = currentType.save();\n          if (saveData === false) {\n            e.preventDefault();\n            return;\n          }\n          resolve(saveData);\n        }\n        modal.hide();\n      });\n      modal.show();\n    });\n  });\n\n});\n"],"file":"dialogue.min.js"}
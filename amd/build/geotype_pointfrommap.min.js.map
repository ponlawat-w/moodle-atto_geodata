{"version":3,"sources":["../src/geotype_pointfrommap.js"],"names":["define","$","Leaflet","OsmBasemap","_map","_point","_marker","setPoint","point","lat","lng","setLatLng","marker","addLayer","html","M","str","atto_geodata","latitude","longitude","removeLayer","nopointselected","init","defaultValue","$body","attr","addClass","appendTo","css","map","setView","on","e","latlng","bind","data","split","x","parseFloat","trim","length","save","$result","outerHTML","dispose","remove","off"],"mappings":"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","sourcesContent":["define([\n  'jquery',\n  'local_leaflet/core',\n  'local_leaflet/osmbasemap'\n], (\n  $,\n  Leaflet,\n  OsmBasemap\n) => ({\n  _map: null,\n  _point: null,\n  _marker: null,\n  setPoint: function(point) {\n    if (point && point.lat && point.lng) {\n      this._point = point;\n      if (this._marker) {\n        this._marker.setLatLng(this._point);\n      } else {\n        this._marker = Leaflet.marker(this._point);\n        this._map.addLayer(this._marker);\n      }\n      $('#atto_geodata-latlng').html(\n        `${M.str.atto_geodata.latitude}: ${this._point.lat},` +\n        ` ${M.str.atto_geodata.longitude}: ${this._point.lng}`\n      );\n    } else {\n      this._point = null;\n      if (this._marker) {\n        this._map.removeLayer(this._marker);\n      }\n      $('#atto_geodata-latlng').html(M.str.atto_geodata.nopointselected);\n    }\n  },\n  init: function(defaultValue) {\n    const $body = $('#atto_geodata-body');\n\n    $('<div>')\n      .attr('id', 'atto_geodata-latlng')\n      .addClass('text-center')\n      .html(M.str.atto_geodata.nopointselected)\n      .appendTo($body);\n\n    $('<div>')\n      .attr('id', 'atto_geodata-map')\n      .css('width', '100%')\n      .css('height', '50vh')\n      .appendTo($body);\n      \n      this._map = Leaflet.map('atto_geodata-map');\n      this._map.addLayer(OsmBasemap);\n      this._map.setView([0, 0], 1);\n      this._map.on('click', function(e) {\n        this.setPoint(e.latlng);\n      }.bind(this));\n      $('#atto_geodata-map').addClass('leaflet-crosshair');\n    \n    if (defaultValue) {\n      const data = defaultValue.split(',').map(x => parseFloat(x.trim()));\n      if (data.length > 1) {\n        this.setPoint({lat: data[0], lng: data[1]});\n      }\n    }\n  },\n  save: function() {\n    if (this._point && this._point.lat && this._point.lng) {\n      const $result = $('<span>')\n        .addClass('filter-geodata filter-geodata-point')\n        .html(`${this._point.lat},${this._point.lng}`);\n      return $result[0].outerHTML;\n    }\n    return false;\n  },\n  dispose: function() {\n    if (this._map) {\n      if (this._marker) {\n        this._marker.remove();\n      }\n      this._marker = null;\n\n      if (this._map) {\n        this._map.off();\n        this._map.remove();\n      }\n      this._map = null;\n    }\n  }\n}));\n"],"file":"geotype_pointfrommap.min.js"}